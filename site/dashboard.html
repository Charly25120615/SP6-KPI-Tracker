<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard KPI — SP6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-slate-50 p-6 font-sans">
    <div class="max-w-7xl mx-auto">
        <header class="mb-10 flex justify-between items-end">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">Tracker KPIs 2026</h1>
                <p id="time" class="text-slate-500 italic"></p>
            </div>
        </header>

        <h2 class="text-xl font-bold mb-4 border-l-4 border-red-600 pl-3">SECCIÓN 1 — Balance Scorecard</h2>
        <div id="bsc-container" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10"></div>

        <h2 class="text-xl font-bold mb-4 border-l-4 border-indigo-600 pl-3">SECCIÓN 2 — Detalle de KPIs</h2>
        <div id="kpi-sections" class="space-y-8 mb-10"></div>

        <h2 class="text-xl font-bold mb-4 border-l-4 border-green-600 pl-3">SECCIÓN 3 — Desempeño de Líderes</h2>
        <div class="bg-white rounded-2xl shadow-sm border overflow-hidden mb-10">
            <table class="w-full text-left">
                <thead class="bg-slate-50 border-b">
                    <tr>
                        <th class="p-4 font-bold">Líder</th>
                        <th class="p-4 text-center">Calificación</th>
                    </tr>
                </thead>
                <tbody id="lideres-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        const getCol = (n) => n >= 90 ? 'text-green-600' : n >= 80 ? 'text-yellow-600' : 'text-red-600';
        const getBg = (n) => n >= 90 ? 'bg-green-500' : n >= 80 ? 'bg-yellow-500' : 'bg-red-500';

        async function load() {
            const res = await fetch('data.json');
            const d = await res.json();
            document.getElementById('time').innerText = `Sincronizado: ${d.lastUpdate}`;

            // Render Sección 1
            document.getElementById('bsc-container').innerHTML = d.bscData.map(i => `
                <div class="${getBg(i.nota)} p-6 rounded-2xl text-white shadow-lg">
                    <p class="text-xs font-bold uppercase opacity-80">${i.categoria}</p>
                    <p class="text-4xl font-black">${i.nota.toFixed(1)}%</p>
                </div>
            `).join('');

            // Render Sección 2 (Segmentada)
            const groups = d.kpis.reduce((acc, k) => {
                acc[k.categoria] = acc[k.categoria] || [];
                acc[k.categoria].push(k);
                return acc;
            }, {});

            document.getElementById('kpi-sections').innerHTML = Object.entries(groups).map(([cat, kpis]) => `
                <div class="bg-white p-6 rounded-2xl shadow-sm border">
                    <h3 class="text-lg font-black text-indigo-900 mb-4 uppercase tracking-wider">${cat}</h3>
                    <div class="grid grid-cols-1 gap-6">
                        ${kpis.map((k, idx) => `
                            <div class="flex flex-col md:flex-row gap-6 items-center border-b pb-6 last:border-0">
                                <div class="flex-1">
                                    <p class="font-bold text-slate-800">${k.kpi}</p>
                                    <p class="text-xs text-slate-500">Meta: ${k.meta}</p>
                                    <p class="text-2xl font-black ${getCol(k.nota)}">${k.nota}%</p>
                                </div>
                                <div class="w-full md:w-1/2 h-32">
                                    <canvas id="chart-${cat}-${idx}"></canvas>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // Crear Histogramas
            Object.entries(groups).forEach(([cat, kpis]) => {
                kpis.forEach((k, idx) => {
                    new Chart(document.getElementById(`chart-${cat}-${idx}`), {
                        type: 'bar',
                        data: {
                            labels: d.meses,
                            datasets: [{ label: 'Tendencia', data: k.trend, backgroundColor: '#6366f1', borderRadius: 4 }]
                        },
                        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                    });
                });
            });

            // Render Sección 3
            document.getElementById('lideres-body').innerHTML = d.lideres.map(l => `
                <tr class="border-b">
                    <td class="p-4 font-medium">${l.nombre}</td>
                    <td class="p-4 text-center font-black ${getCol(l.nota)}">${l.nota}%</td>
                </tr>
            `).join('');
        }
        load();
    </script>
</body>
</html>
