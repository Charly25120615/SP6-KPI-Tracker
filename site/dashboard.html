<script>
    let globalData, mainChart;

    async function init() {
        const res = await fetch('data.json');
        globalData = await res.json();
        
        // Llenar el selector con los nombres de la Columna F
        const selector = document.getElementById('kpi-selector');
        selector.innerHTML = globalData.kpis.map((k, idx) => `
            <option value="${idx}">${k.nombre}</option>
        `).join('');

        selector.addEventListener('change', (e) => updateChart(e.target.value));
        
        // Cargar el primer KPI por defecto
        updateChart(0);
    }

    function updateChart(idx) {
        const kpi = globalData.kpis[idx];
        if (mainChart) mainChart.destroy();
        
        const ctx = document.getElementById('main-chart').getContext('2d');
        mainChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: globalData.meses,
                datasets: [{
                    label: 'Tendencia Mensual',
                    data: kpi.trend,
                    backgroundColor: 'rgba(220, 38, 38, 0.8)', // Rojo SP6
                    borderRadius: 8
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, max: 100 }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }
    init();
</script>
