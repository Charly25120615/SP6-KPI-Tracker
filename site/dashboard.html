<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SP6 — Dashboard Ejecutivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.8)), url('../pared.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen text-slate-900">
    <div class="max-w-7xl mx-auto">
        <header class="mb-10 flex flex-col md:flex-row justify-between items-center bg-white/10 p-6 rounded-3xl border border-white/20">
            <h1 class="text-4xl font-black text-white tracking-tighter">SP6 TECNOLOGÍAS <span class="text-red-500">2026</span></h1>
            <p id="time" class="text-white/70 font-mono"></p>
        </header>

        <h2 class="text-xl font-bold text-white mb-6 uppercase tracking-widest border-l-4 border-red-500 pl-4">Sección 1: Balance Scorecard</h2>
        <div id="bsc-container" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-16"></div>

        <div class="glass p-8 rounded-[2rem] shadow-2xl mb-16 border border-white/20">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-black text-slate-800 uppercase italic">Análisis Dinámico de Tendencia</h2>
                <select id="kpi-selector" class="bg-slate-100 border-none p-3 rounded-xl font-bold text-indigo-600 focus:ring-2 ring-indigo-500 w-full md:w-72"></select>
            </div>
            <div class="h-80"><canvas id="main-chart"></canvas></div>
        </div>

        <h2 class="text-xl font-bold text-white mb-6 uppercase tracking-widest border-l-4 border-indigo-500 pl-4">Sección 2: Detalle de KPIs por Segmento</h2>
        <div id="kpi-groups" class="space-y-12 mb-16"></div>

        <h2 class="text-xl font-bold text-white mb-6 uppercase tracking-widest border-l-4 border-green-500 pl-4">Sección 3: Desempeño de Líderes</h2>
        <div id="lideres-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-10"></div>
    </div>

    <script>
        let globalData, mainChart;
        const getCol = (n) => n >= 90 ? 'text-green-600' : n >= 80 ? 'text-yellow-600' : 'text-red-600';
        const getBg = (n) => n >= 90 ? 'bg-green-500' : n >= 80 ? 'bg-yellow-500' : 'bg-red-500';

        async function init() {
            const res = await fetch('data.json');
            globalData = await res.json();
            document.getElementById('time').innerText = globalData.lastUpdate;

            // Render Sec 1
            document.getElementById('bsc-container').innerHTML = globalData.bscData.map(i => `
                <div class="${getBg(i.nota)} p-6 rounded-3xl text-white shadow-xl">
                    <p class="text-[10px] font-black uppercase opacity-70 mb-1">${i.categoria}</p>
                    <p class="text-4xl font-black">${i.nota.toFixed(1)}%</p>
                </div>
            `).join('');

            // Selector e Histograma
            const selector = document.getElementById('kpi-selector');
            selector.innerHTML = globalData.kpis.map((k, idx) => `<option value="${idx}">${k.nombre}</option>`).join('');
            selector.addEventListener('change', (e) => updateChart(e.target.value));
            updateChart(0);

            // Render Sec 2 (Tarjetas segmentadas)
            const groups = globalData.kpis.reduce((acc, k) => {
                acc[k.categoria] = acc[k.categoria] || [];
                acc[k.categoria].push(k);
                return acc;
            }, {});

            document.getElementById('kpi-groups').innerHTML = Object.entries(groups).map(([cat, kpis]) => `
                <div>
                    <h3 class="text-white text-lg font-black mb-4 uppercase opacity-80 pl-2">${cat}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${kpis.map(k => `
                            <div class="glass p-5 rounded-2xl shadow-lg border-b-4 ${k.nota >= 90 ? 'border-green-500' : k.nota >= 80 ? 'border-yellow-500' : 'border-red-500'}">
                                <p class="text-xs font-bold text-slate-400 mb-1">KPI</p>
                                <p class="font-black text-slate-800 leading-tight h-10 overflow-hidden mb-2">${k.nombre}</p>
                                <div class="flex justify-between items-end">
                                    <p class="text-3xl font-black ${getCol(k.nota)}">${k.nota}%</p>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase">Meta: ${k.meta}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // Render Sec 3 (Líderes)
            document.getElementById('lideres-container').innerHTML = globalData.lideres.map(l => `
                <div class="glass p-4 rounded-2xl text-center shadow-md">
                    <p class="text-xs font-bold text-slate-500 mb-1">LÍDER</p>
                    <p class="font-black text-slate-800 text-sm mb-2 truncate">${l.nombre}</p>
                    <p class="text-2xl font-black ${getCol(l.nota)}">${l.nota}%</p>
                </div>
            `).join('');
        }

        function updateChart(idx) {
            const kpi = globalData.kpis[idx];
            if (mainChart) mainChart.destroy();
            const ctx = document.getElementById('main-chart').getContext('2d');
            mainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: globalData.meses,
                    datasets: [{
                        label: kpi.nombre,
                        data: kpi.trend,
                        backgroundColor: '#ef4444',
                        borderRadius: 8
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }

        init();
    </script>
</body>
</html>
