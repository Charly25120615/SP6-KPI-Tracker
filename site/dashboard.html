<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Táctico BSC SP6 Tecnologias 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --blue-sp6: #0077b6;
            --bg-dark: #0f1115;
            --border: #2d3139;
        }
        body {
            /* Capa oscura balanceada para que pared.jpg se vea profesional */
            background: linear-gradient(rgba(15, 17, 21, 0.85), rgba(15, 17, 21, 0.85)), url('../pared.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #e2e8f0;
        }
        .glass { 
            background: rgba(26, 29, 35, 0.9); 
            backdrop-filter: blur(12px); 
            border: 1px solid var(--border); 
        }
        /* Estilo Milestone del Roadmap aplicado a KPIs */
        .kpi-card {
            background: #1a1d23;
            border: 1px solid var(--border);
            border-left: 5px solid #475569;
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            border-color: var(--blue-sp6);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }
        .status-verde { border-left-color: #10b981 !important; }
        .status-amarillo { border-left-color: #f59e0b !important; }
        .status-rojo { border-left-color: #ef4444 !important; }
    </style>
</head>
<body class="p-4 md:p-12 font-sans">
    <div class="max-w-7xl mx-auto">
        <header class="mb-12 text-center border-b border-white/10 pb-8">
            <h1 class="text-4xl font-black text-white tracking-widest uppercase italic">SP6 Tecnologías</h1>
            <div class="text-[#0077b6] font-bold text-xl tracking-widest mt-2 uppercase">Dashboard Táctico BSC 2026</div>
            <p id="time" class="text-xs font-mono opacity-50 mt-4 italic"></p>
        </header>

        <h2 class="text-xs font-black uppercase tracking-[0.3em] mb-6 text-[#0077b6] ml-2">1. Resumen de Perspectivas</h2>
        <div id="bsc-container" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-16"></div>

        <div class="glass p-8 rounded-[2rem] shadow-2xl mb-16">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <h2 class="text-xl font-bold uppercase tracking-tight text-white">Tendencia de Logro Mensual</h2>
                <select id="kpi-selector" class="bg-[#1a1d23] border border-var(--border) p-4 rounded-xl font-bold text-[#0077b6] w-full md:w-[32rem] focus:ring-2 ring-[#0077b6] cursor-pointer shadow-inner"></select>
            </div>
            <div class="h-80"><canvas id="main-chart"></canvas></div>
        </div>

        <h2 class="text-xs font-black uppercase tracking-[0.3em] mb-8 text-[#0077b6] ml-2">2. Detalle de KPIs por Segmento (B1:W44)</h2>
        <div id="kpi-groups" class="space-y-16 mb-20"></div>

        <h2 class="text-xs font-black uppercase tracking-[0.3em] mb-6 text-[#10b981] ml-2">3. Desempeño Gerencial</h2>
        <div id="lideres-container" class="grid grid-cols-2 md:grid-cols-5 gap-6 mb-10"></div>
    </div>

    <script>
        let globalData, mainChart;
        
        const getStatusClass = (n) => n >= 90 ? 'status-verde' : n >= 80 ? 'status-amarillo' : 'status-rojo';
        const getCol = (n) => n >= 90 ? 'text-green-500' : n >= 80 ? 'text-yellow-500' : 'text-red-500';

        async function init() {
            try {
                const res = await fetch('data.json');
                globalData = await res.json();
                document.getElementById('time').innerText = `Última actualización: ${globalData.lastUpdate}`;

                // SECCIÓN 1: PERSPECTIVAS
                document.getElementById('bsc-container').innerHTML = globalData.bscData.map(i => `
                    <div class="glass p-8 rounded-2xl text-center border-t-4 ${i.nota >= 90 ? 'border-green-500' : i.nota >= 80 ? 'border-yellow-500' : 'border-red-500'}">
                        <p class="text-[10px] font-black uppercase opacity-60 mb-2">${i.categoria}</p>
                        <p class="text-4xl font-black text-white">${i.nota.toFixed(1)}%</p>
                    </div>
                `).join('');

                // SELECTOR KPI
                const selector = document.getElementById('kpi-selector');
                selector.innerHTML = globalData.kpis.map((k, idx) => `<option value="${idx}">${k.nombre}</option>`).join('');
                selector.addEventListener('change', (e) => updateChart(e.target.value));
                updateChart(0);

                // SECCIÓN 2: TARJETAS ESTILO ROADMAP
                const groups = globalData.kpis.reduce((acc, k) => {
                    acc[k.categoria] = acc[k.categoria] || [];
                    acc[k.categoria].push(k);
                    return acc;
                }, {});

                document.getElementById('kpi-groups').innerHTML = Object.entries(groups).map(([cat, kpis]) => `
                    <div>
                        <h3 class="text-sm font-black mb-6 uppercase opacity-40 border-b border-white/5 pb-2 ml-2 tracking-widest">${cat}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${kpis.map(k => `
                                <div class="kpi-card p-6 rounded-xl ${getStatusClass(k.nota)}">
                                    <div class="text-[10px] font-bold text-[#0077b6] mb-2 uppercase opacity-80">${cat}</div>
                                    <div class="font-bold text-white text-[14px] leading-snug mb-6 h-10 overflow-hidden" title="${k.nombre}">${k.nombre}</div>
                                    <div class="flex justify-between items-end">
                                        <div>
                                            <p class="text-[9px] uppercase opacity-40 leading-none mb-1">Nota Actual</p>
                                            <p class="text-4xl font-black ${getCol(k.nota)}">${k.nota}%</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-[9px] uppercase opacity-40 leading-none mb-1">Meta</p>
                                            <p class="text-sm font-bold text-white">${k.meta}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

                // SECCIÓN 3: GERENCIA
                document.getElementById('lideres-container').innerHTML = globalData.lideres.map(l => `
                    <div class="glass p-6 rounded-2xl text-center border-b-4 ${getStatusClass(l.nota).replace('status-','border-')}">
                        <p class="font-bold text-white text-xs mb-2 truncate uppercase tracking-tighter">${l.nombre}</p>
                        <p class="text-2xl font-black ${getCol(l.nota)}">${l.nota}%</p>
                    </div>
                `).join('');
            } catch (e) { console.error("Error al cargar:", e); }
        }

        function updateChart(idx) {
            const kpi = globalData.kpis[idx];
            if (mainChart) mainChart.destroy();
            const ctx = document.getElementById('main-chart').getContext('2d');
            mainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: globalData.meses,
                    datasets: [{
                        label: 'Logro %',
                        data: kpi.trend,
                        backgroundColor: '#0077b6',
                        hoverBackgroundColor: '#00b4d8',
                        borderRadius: 6
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: { backgroundColor: '#1a1d23', titleFont: { size: 14 } }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, max: 100, 
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#64748b' } 
                        },
                        x: { grid: { display: false }, ticks: { color: '#64748b' } }
                    }
                }
            });
        }
        init();
    </script>
</body>
</html>
